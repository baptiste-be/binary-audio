<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binary Audio Simulator</title>
<style>
body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    background: linear-gradient(135deg,#e0e0e5,#f2f2f7);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.card{
    background:rgba(255,255,255,0.85);
    backdrop-filter: blur(30px);
    padding:40px;
    width:450px;
    border-radius:32px;
    box-shadow:0 30px 60px rgba(0,0,0,0.15);
    text-align:center;
}
h1{
    margin-bottom:25px;
    font-weight:700;
    color:#111;
}
input{
    width:100%;
    padding:16px;
    border-radius:20px;
    border:none;
    background:#f5f5f7;
    font-size:16px;
    margin-bottom:20px;
    box-shadow: inset 2px 2px 6px rgba(0,0,0,0.08);
}
button{
    width:100%;
    padding:16px;
    border-radius:20px;
    border:none;
    font-size:16px;
    margin:10px 0;
    cursor:pointer;
    font-weight:600;
    transition:0.2s;
}
.emit{ background:#111; color:white; }
.listen{ background:#0071e3; color:white; }
button:hover{ transform:scale(1.04); }
#status{
    margin-top:20px;
    font-weight:500;
    min-height:40px;
    color:#222;
}
</style>
</head>
<body>
<div class="card">
<h1>Binary Audio Simulator</h1>
<input id="textInput" placeholder="Tape un mot ou une phrase">
<button class="emit" onclick="emit()">Émettre</button>
<button class="listen" onclick="listen()">Recevoir</button>
<div id="status">Prêt</div>
</div>

<script>
const bitDuration = 200; // ms
const START = "11111111";
const END   = "00000000";
let audioCtx;

// TEXT ↔ BINARY
function textToBinary(text){
    return text.split('').map(c=>c.charCodeAt(0).toString(2).padStart(8,'0')).join('');
}
function binaryToText(binary){
    let text='';
    for(let i=0;i<binary.length;i+=8){
        let byte = binary.slice(i,i+8);
        if(byte.length===8) text += String.fromCharCode(parseInt(byte,2));
    }
    return text;
}

// EMISSION (joue le son)
async function emit(){
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const text = document.getElementById("textInput").value;
    if(!text){ document.getElementById("status").innerText="Tape quelque chose !"; return; }
    let binary = START + textToBinary(text) + END;
    let now = audioCtx.currentTime;
    for(let i=0;i<binary.length;i++){
        const osc = audioCtx.createOscillator();
        osc.type="sine";
        osc.frequency.value = binary[i]==="0"?400:1000;
        osc.connect(audioCtx.destination);
        osc.start(now + i*(bitDuration/1000));
        osc.stop(now + i*(bitDuration/1000)+bitDuration/1000);
    }
    document.getElementById("status").innerText="Message envoyé !";
}

// SIMULATION “RECEPTION” (fiable)
async function listen(){
    document.getElementById("status").innerText="Réception en cours...";
    const text = document.getElementById("textInput").value;
    if(!text){ document.getElementById("status").innerText="Aucun message à recevoir"; return; }

    // On simule la réception après un délai
    const binary = START + textToBinary(text) + END;

    let index = 0;
    let receivedBinary = "";
    const interval = setInterval(()=>{
        if(index<binary.length){
            receivedBinary += binary[index];
            index++;
        }else{
            clearInterval(interval);
            const receivedText = binaryToText(receivedBinary.replace(START,'').replace(END,''));
            document.getElementById("status").innerText = "Reçu : "+receivedText;
        }
    }, bitDuration);
}
</script>
</body>
</html>
